# =============================================================================
# Atlas Ansible Site Playbook
# =============================================================================
# Main playbook that includes all service playbooks.
#
# Usage:
#   ENV=cluster01 ansible-playbook playbooks/site.yml
#
# To run specific services only:
#   ENV=cluster01 ansible-playbook playbooks/site.yml --limit prometheus
#   ENV=cluster01 ansible-playbook playbooks/site.yml --tags forgejo_runner

---
# Monitoring Stack
- name: Configure Prometheus
  ansible.builtin.import_playbook: prometheus.yml
  tags:
    - prometheus
    - monitoring

- name: Configure Alertmanager
  ansible.builtin.import_playbook: alertmanager.yml
  tags:
    - alertmanager
    - monitoring

# Infrastructure Services
- name: Configure PostgreSQL
  ansible.builtin.import_playbook: postgresql.yml
  tags:
    - postgresql
    - database

- name: Configure step-ca
  ansible.builtin.import_playbook: step-ca.yml
  tags:
    - step_ca
    - tls
    - pki

- name: Configure Mosquitto
  ansible.builtin.import_playbook: mosquitto.yml
  tags:
    - mosquitto
    - mqtt

# Application Services
- name: Configure Forgejo
  ansible.builtin.import_playbook: forgejo.yml
  tags:
    - forgejo
    - git

- name: Configure Forgejo Runners
  ansible.builtin.import_playbook: forgejo-runner.yml
  tags:
    - forgejo_runner
    - runners

# Observability Stack
- name: Configure Alloy
  ansible.builtin.import_playbook: alloy.yml
  tags:
    - alloy
    - observability

- name: Configure Grafana
  ansible.builtin.import_playbook: grafana.yml
  tags:
    - grafana
    - observability

- name: Configure Loki
  ansible.builtin.import_playbook: loki.yml
  tags:
    - loki
    - observability

# DNS
- name: Configure CoreDNS
  ansible.builtin.import_playbook: coredns.yml
  tags:
    - coredns
    - dns

# Identity & Authorization
- name: Configure OpenFGA
  ansible.builtin.import_playbook: openfga.yml
  tags:
    - openfga
    - identity

- name: Configure Dex
  ansible.builtin.import_playbook: dex.yml
  tags:
    - dex
    - identity
