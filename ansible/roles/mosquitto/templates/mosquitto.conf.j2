# Mosquitto MQTT Broker Configuration
# Generated by Ansible - DO NOT EDIT MANUALLY

# Persistence
persistence true
persistence_location {{ mosquitto_data_dir }}/

# Logging
log_dest stdout
log_type error
log_type warning
log_type notice
log_type information
connection_messages true
log_timestamp true

{% if mosquitto_users | length > 0 %}
# Authentication
allow_anonymous false
password_file {{ mosquitto_config_dir }}/passwd
{% else %}
# No authentication configured
allow_anonymous true
{% endif %}

# Plain MQTT listener
listener {{ mosquitto_mqtt_port }} 0.0.0.0
protocol mqtt

{% if mosquitto_enable_tls %}
# TLS MQTT listener
listener {{ mosquitto_mqtts_port }} 0.0.0.0
protocol mqtt
certfile {{ mosquitto_tls_dir }}/mosquitto.crt
keyfile {{ mosquitto_tls_dir }}/mosquitto.key
cafile {{ mosquitto_tls_dir }}/ca.crt
tls_version tlsv1.2
{% endif %}

{% if mosquitto_config | length > 0 %}
# Custom configuration
{{ mosquitto_config }}
{% endif %}
