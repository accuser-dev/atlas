#cloud-config
# HAProxy load balancer cloud-init configuration
# Uses Debian Trixie with systemd service management

package_update: true
package_upgrade: false

packages:
  - haproxy

write_files:
  - path: /etc/haproxy/haproxy.cfg
    permissions: '0644'
    content: |
      ${indent(6, haproxy_config)}

runcmd:
  # Enable and start HAProxy service (uses package-provided systemd unit)
  - systemctl daemon-reload
  - systemctl enable haproxy
  - systemctl start haproxy
